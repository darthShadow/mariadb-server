#
# MDEV-12459: The information_schema tables for getting temporary tables
#             info is missing, at least for innodb, there is no
#             INNODB_TEMP_TABLE_INFO
#
# -------------------------------
# Test shadowing of a base table
# -------------------------------
create database some_db;
use some_db;
# Test the warning is raised
create table t(t int);
create temporary table t(t int);
Warnings:
Note	1050	Table 't' already exists
drop table t;
drop table t;
use test;
# ------------------------
# IS.tables tests
# ------------------------
# Create first temporary table
create temporary table test.t_temp(t int);
insert into t_temp values (1),(2), (3);
# Show results
select table_schema, table_name, temporary from  information_schema.tables where table_type='temporary';
table_schema	test
table_name	t_temp
temporary	Y
# Create the base table with the same name (both should be visible)
create table test.t_temp(t int);
insert into t_temp values (-1),(-2);
# Show results
select table_schema, table_name, temporary from  information_schema.tables where table_type='temporary';
table_schema	test
table_name	t_temp
temporary	Y
create database my_db;
# Create the temporary table with the same name in new DB
create temporary table my_db.t_temp (t int);
insert into my_db.t_temp values (-2),(-1);
# Show results
select table_schema, table_name, temporary from  information_schema.tables where table_type='temporary';
table_schema	my_db
table_name	t_temp
temporary	Y
table_schema	test
table_name	t_temp
temporary	Y
connect  con1,localhost,root,,my_db,,;
# Create the temporary table with the same name in new connection
create temporary table t_temp(t int);
insert into t_temp values (4),(5),(6), (7);
# Show results
select table_schema, table_name, temporary from  information_schema.tables where table_type='temporary';
table_schema	my_db
table_name	t_temp
temporary	Y
connection default;
# Show results in default connection
select table_schema, table_name, temporary from  information_schema.tables where table_type='temporary';
table_schema	my_db
table_name	t_temp
temporary	Y
table_schema	test
table_name	t_temp
temporary	Y
# Create a warning on `Create` statement if the new temporary table
# shadows base table - note there is no warning vice versa.
create table some_db.my_t (t int);
show warnings;
create temporary table some_db.my_t (t int);
Warnings:
Level	Note
Code	1050
Message	Table 'my_t' already exists
show warnings;
Level	Note
Code	1050
Message	Table 'my_t' already exists
# Show results
select table_schema, table_name, temporary from  information_schema.tables where table_type='temporary';
table_schema	some_db
table_name	my_t
temporary	Y
table_schema	my_db
table_name	t_temp
temporary	Y
table_schema	test
table_name	t_temp
temporary	Y
drop table some_db.my_t;
drop table some_db.my_t;
disconnect con1;
drop table test.t_temp;
drop table test.t_temp;
drop database my_db;
drop database some_db;
#
# MDEV-28332: Alter on temporary table causes ER_TABLE_EXISTS_ERROR note
#
create table t (a int);
create temporary table t (b int);
Warnings:
Level	Note
Code	1050
Message	Table 't' already exists
alter table t add c int;
drop temporary table t;
drop table t;
#
# MDEV-28334: SHOW TABLE STATUS shows all temporary tables
#             ignoring database and conditions
#
create temporary table test.tmp_in_test (a int);
create table test.base_in_test (t int);
create table test.tmp_in_test (t int);
create temporary table test.tmp_innodb_in_test (a int) engine=InnoDB;
create database mysqltest;
use mysqltest;
show table status;
show table status in mysqltest;
show table status in test;
Name	Engine	Version	Row_format	Rows	Avg_row_length	Data_length	Max_data_length	Index_length	Data_free	Auto_increment	Create_time	Update_time	Check_time	Collation	Checksum	Create_options	Comment	Max_index_length	Temporary
tmp_innodb_in_test	InnoDB	10	Dynamic	0	0	16384	0	0	6291456	NULL	#	#	#	latin1_swedish_ci	NULL			0	Y
tmp_in_test	MyISAM	10	Fixed	0	0	0	1970324836974591	1024	0	NULL	#	#	#	latin1_swedish_ci	NULL			17179868160	Y
base_in_test	MyISAM	10	Fixed	0	0	0	1970324836974591	1024	0	NULL	#	#	#	latin1_swedish_ci	NULL			17179868160	N
tmp_in_test	MyISAM	10	Fixed	0	0	0	1970324836974591	1024	0	NULL	#	#	#	latin1_swedish_ci	NULL			17179868160	N
show table status from test;
Name	Engine	Version	Row_format	Rows	Avg_row_length	Data_length	Max_data_length	Index_length	Data_free	Auto_increment	Create_time	Update_time	Check_time	Collation	Checksum	Create_options	Comment	Max_index_length	Temporary
tmp_innodb_in_test	InnoDB	10	Dynamic	0	0	16384	0	0	6291456	NULL	#	#	#	latin1_swedish_ci	NULL			0	Y
tmp_in_test	MyISAM	10	Fixed	0	0	0	1970324836974591	1024	0	NULL	#	#	#	latin1_swedish_ci	NULL			17179868160	Y
base_in_test	MyISAM	10	Fixed	0	0	0	1970324836974591	1024	0	NULL	#	#	#	latin1_swedish_ci	NULL			17179868160	N
tmp_in_test	MyISAM	10	Fixed	0	0	0	1970324836974591	1024	0	NULL	#	#	#	latin1_swedish_ci	NULL			17179868160	N
# check that InnoDB temporary table
# has a NULL value for `Create time` column (MDEV-28333)
select create_time from information_schema.tables where table_name='tmp_innodb_in_test';
create_time
NULL
show table status like 'nonexisting';
Name	Engine	Version	Row_format	Rows	Avg_row_length	Data_length	Max_data_length	Index_length	Data_free	Auto_increment	Create_time	Update_time	Check_time	Collation	Checksum	Create_options	Comment	Max_index_length	Temporary
drop database mysqltest;
drop table test.base_in_test;
drop table test.tmp_in_test;
drop table test.tmp_in_test;
