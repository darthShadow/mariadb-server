#
# MDEV-12459: The information_schema tables for getting temporary tables
#             info is missing, at least for innodb, there is no
#             INNODB_TEMP_TABLE_INFO
#
# -------------------------------
# Test shadowing of a base table
# -------------------------------
connect  con1,localhost,root,,test,,;
# Test the warning is raised
create table t(t int);
create temporary table t(t int);
Warnings:
Note	1050	Table 't' already exists
create user foo@localhost identified by 'bar';
# Test shadowing of the base table for user with no privileges - no warning
connect  con2,localhost,foo,bar,test,,;
show grants for current_user();
Grants for foo@localhost
GRANT USAGE ON *.* TO `foo`@`localhost` IDENTIFIED BY PASSWORD '*E8D46CE25265E545D225A8A6F1BAF642FEBEE5CB'
show tables;
Tables_in_test
t
create temporary table t(t int);
Warnings:
Note	1050	Table 't' already exists
show warnings;
Level	Code	Message
Note	1050	Table 't' already exists
show create table t;
Table	Create Table
t	CREATE TEMPORARY TABLE `t` (
  `t` int(11) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
disconnect con2;
# Give the privileges to the user
connection con1;
grant all privileges on *.* to foo@localhost with grant option;
# Test shadowing of the base table for user that has valid privileges - warning
connect  con2,localhost,foo,bar,test,,;
show grants for current_user();
Grants for foo@localhost
GRANT ALL PRIVILEGES ON *.* TO `foo`@`localhost` IDENTIFIED BY PASSWORD '*E8D46CE25265E545D225A8A6F1BAF642FEBEE5CB' WITH GRANT OPTION
show tables;
Tables_in_test
t
create temporary table t(t int);
Warnings:
Note	1050	Table 't' already exists
show create table t;
Table	Create Table
t	CREATE TEMPORARY TABLE `t` (
  `t` int(11) DEFAULT NULL
) ENGINE=MyISAM DEFAULT CHARSET=latin1
show warnings;
Level	Code	Message
disconnect con2;
# Clean the user
connection con1;
drop table t;
drop table t;
drop user foo@localhost;
# ------------------------
# IS.tables tests
# ------------------------
connection default;
# Create first temporary table
create temporary table test.t_temp(t int);
insert into t_temp values (1),(2), (3);
# Show results
select table_schema, table_name, temporary from  information_schema.tables where table_type='temporary';
table_schema	test
table_name	t_temp
temporary	Y
# Create the base table with the same name (both should be visible)
create table test.t_temp(t int);
insert into t_temp values (-1),(-2);
# Show results
select table_schema, table_name, temporary from  information_schema.tables where table_type='temporary';
table_schema	test
table_name	t_temp
temporary	Y
create database my_db;
# Create the temporary table with the same name in new DB
create temporary table my_db.t_temp (t int);
insert into my_db.t_temp values (-2),(-1);
# Show results
select table_schema, table_name, temporary from  information_schema.tables where table_type='temporary';
table_schema	my_db
table_name	t_temp
temporary	Y
table_schema	test
table_name	t_temp
temporary	Y
connection con1;
# Create the temporary table with the same name in new connection
create temporary table test.t_temp(t int);
Warnings:
Level	Note
Code	1050
Message	Table 't_temp' already exists
insert into t_temp values (4),(5),(6), (7);
# Show results
select table_schema, table_name, temporary from  information_schema.tables where table_type='temporary';
table_schema	test
table_name	t_temp
temporary	Y
connection default;
# Show results in default connection
select table_schema, table_name, temporary from  information_schema.tables where table_type='temporary';
table_schema	my_db
table_name	t_temp
temporary	Y
table_schema	test
table_name	t_temp
temporary	Y
# Create a warning on `Create` statement if the new temporary table
# shadows base table - note there is no warning vice versa.
create table test.my_t (t int);
create temporary table test.my_t (t int);
Warnings:
Level	Note
Code	1050
Message	Table 'my_t' already exists
show warnings;
Level	Note
Code	1050
Message	Table 'my_t' already exists
# Show results
select table_schema, table_name, temporary from  information_schema.tables where table_type='temporary';
table_schema	test
table_name	my_t
temporary	Y
table_schema	my_db
table_name	t_temp
temporary	Y
table_schema	test
table_name	t_temp
temporary	Y
drop table test.my_t;
drop table test.my_t;
disconnect con1;
drop table test.t_temp;
drop table test.t_temp;
drop database my_db;
